(()=>{var y=a=>Number.parseInt(a,10)||0,R=(a="")=>a.split(" ").map(i=>i.trim()).filter(Boolean),L=(a="")=>a?a.trim().toLowerCase():"",v=a=>{if(!a)return"";let i=a.trim();if(!i)return"";let m=i.match(/^(\d{4})$/);return m?m[1]:""},S=a=>{if(!a)return null;let i=Number.parseInt(a,10);return Number.isFinite(i)?i:null};typeof window!="undefined"&&window.addEventListener("DOMContentLoaded",()=>{let a=document.querySelector("[data-endeavours-controls]"),i=document.querySelector("[data-endeavours-grid]");if(!a||!i)return;let m=Array.from(i.querySelectorAll("[data-endeavour]"));if(m.length===0)return;let u=a.querySelector('[data-filter="type"]'),d=a.querySelector('[data-filter="tag"]'),l=a.querySelector("[data-sort]"),o=a.querySelector('[data-filter="from"]'),n=a.querySelector('[data-filter="to"]'),b=document.querySelector("[data-endeavours-empty]"),q=a.querySelector("[data-filter-reset]"),w=new Set(["recent","learning","enjoyment","effort","success"]);a.hidden=!1;let F=(t,e)=>e==="recent"?t.slice().sort((r,s)=>y(s.dataset.date)-y(r.dataset.date)):w.has(e)&&e!=="recent"?t.slice().sort((r,s)=>{let p=y(s.dataset[e])-y(r.dataset[e]);return p===0?y(s.dataset.date)-y(r.dataset.date):p}):t.slice(),I=()=>{let t=new URLSearchParams(window.location.search),e=L(t.get("type")),r=L(t.get("tag")),s=t.get("sort"),p=w.has(s)?s:"recent",h=v(t.get("from")),c=v(t.get("to"));return{type:e,tag:r,sort:p,from:h,to:c}},E=(t,e)=>{if(!t||!e)return;Array.from(t.options).some(s=>s.value===e)&&(t.value=e)},C=t=>{E(u,t.type),E(d,t.tag),l&&t.sort&&(l.value=t.sort),o&&!o.disabled&&(o.value=t.from||""),n&&!n.disabled&&(n.value=t.to||"")},A=()=>{let t=o&&!o.disabled?v(o.value):"",e=n&&!n.disabled?v(n.value):"";return o&&!o.disabled&&(o.value=t),n&&!n.disabled&&(n.value=e),{type:u?u.value:"",tag:d&&!d.disabled?d.value:"",sort:l&&w.has(l.value)?l.value:"recent",from:t,to:e}},N=t=>{if(!window.history||!window.history.replaceState)return;let e=new URLSearchParams;t.type&&e.set("type",t.type),t.tag&&e.set("tag",t.tag),t.sort&&t.sort!=="recent"&&e.set("sort",t.sort),t.from&&e.set("from",t.from),t.to&&e.set("to",t.to);let r=e.toString(),s=`${window.location.pathname}${r?`?${r}`:""}${window.location.hash}`;window.history.replaceState({},"",s)},U=t=>{t.hidden=!0,t.style.display="none",t.setAttribute("aria-hidden","true")},$=t=>{t.hidden=!1,t.style.display="",t.removeAttribute("aria-hidden")},f=()=>{let t=A(),e=S(t.from),r=S(t.to),p=e&&r&&e>r?[]:m.filter(c=>{let V=!t.type||c.dataset.type===t.type,Y=R(c.dataset.tags),x=!t.tag||Y.includes(t.tag),g=S(c.dataset.year),z=!e||g&&g>=e,B=!r||g&&g<=r;return V&&x&&z&&B}),h=F(p,t.sort);m.forEach(c=>{U(c)}),h.forEach(c=>{$(c),i.appendChild(c)}),b&&(b.hidden=h.length!==0),N(t)};u&&u.addEventListener("change",f),d&&d.addEventListener("change",f),l&&l.addEventListener("change",f),o&&o.addEventListener("change",f),n&&n.addEventListener("change",f);let T=()=>{u&&(u.value=""),d&&!d.disabled&&(d.value=""),l&&(l.value="recent"),o&&!o.disabled&&(o.value=""),n&&!n.disabled&&(n.value=""),f()};q&&q.addEventListener("click",T);let P=I();C(P),f()});})();
